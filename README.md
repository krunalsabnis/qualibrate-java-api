# Qaulibrate API 2.0

This is a Demo Microservice REST APIs written in Java 8 using Spring Boot.
It tries to follow API maturity model Level 3 using Swagger and asciidoc for API documentation.
Integration test using JUnit and H2DB for "test" profile. (No Mocks !)

CI/CD : Using Travis for CI/CD : (Currently it runs only builds on every commit and merge.)

## Minimum Prerequisites

* Java 8 SDK
* MySQL 5.7.21 running on port 3306 with an existing DB schema as "qualibrate"

## Build

Build process includes,
* Test Cases
* StyleCheck (in process)
* Code Quality Check (in process)
* asciidoc doc job to generate API documentation
* build executable jar of spring-boot app

There are two ways you can build the project.
Both are one command build only.

1. Build in your local environment
once you clone this repository, in project root folder execute below command.

```
> ./gradlew build

```
Note : For Windows environment asciidoc sometimes gives warning (due to a bug with Ruby)
and shows that build is failed which really has not. Hence, i recommend to use second approach below using docker image based on Linux

2. Use Docker as Build machine.
This app needs Java 8 to build and JRE 8 for runtime. I have created a simple docker build machine based on official Java 8 image.

Make sure your docker environment is already setup.

You need to run a docker image and pass two parameters as below

1. Git URL : in this case its same as this repository's URL
2. Docker's path : for mounted volume. so make sure you mount a volume and specify the path

Command to build using docker build machine

```
docker run --name {name-for-your-container} -e GIT_REPO_URL='https://github.com/krunalsabnis/qualibrate-java-api.git' -e DOCKER_PATH='{path-on-container-filesystem where git will clone and gradle build is run}' -i -v {your-local-dir}:{path-on-container-filesystem} krunalsabnis/spring-java-build:latest
```

You should be able to see build progress on console. Once done the build docker container remains running unless you stop it. 
[For more details Please refer  https://hub.docker.com/r/krunalsabnis/spring-java-build/]



## Run

This app can be run in two ways.

1. Run as standalone spring-boot application
Make sure your local instance of MySQL is running on port 3306 and already has DB with name as "qualibrate".

```
> ./gradlew bootRun
OR
> java -jar  ./build/libs/qualibrate-java-api-0.0.1-SNAPSHOT.jar --spring.profiles.active=dev
```
|profile|database|load dummy data|port|db name|
-----------------------------------------------
|none = default| MySQL| N|3306|qualibrate|
|none = test| H2DB| Y|3306|qualibrate(auto created)|
|none = dev| MySQL| Y|3306|qualibrate|
|none = prod| MySQL| N|3306|qualibrate|



2. Docker Compose for [MySQL, Spring Boot App, nginx]
runs with "dev" profile and It brings three containers up.
 a. MySQL instance
 b. Spring Boot app instance
 c. nginx for static content - as of now it hosts API documentation generated by asciidoc

 In case of "dev" profile also dummy data is loaded but in MySQL and not in H2DB as in case of "test"
  
    


```
> docker-compose up
```
## Once containers are up you can access APIs as below

# API Base URL 	:  http://localhost:8080
# Swagger Page	:  http://localhost:8080/swagger-ui.html
# API Documents	:  http://localhost:8085









